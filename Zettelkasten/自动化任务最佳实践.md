# 自动化任务的最佳实践

**创建时间**: 2026-02-03 20:17
**类型**: 方法论 (Methodology)
**标签**: #automation #best-practices #cron

---

## 从123盘备份中学到的

### 设计原则

**1. 幂等性**
- 脚本可以重复运行，不会出错
- 检查前置条件（如挂载状态）
- 失败时有清晰的错误信息

**2. 可观测性**
- 完整的日志记录
- 成功/失败都有输出
- 保存日志供后续检查

**3. 健壮性**
- 失败自动重试（如重新挂载）
- 资源清理（保留策略）
- 不干扰正常运行

---

## Cron vs 心跳

**使用Cron当**:
- ✅ 需要精确时间（每天9:00）
- ✅ 隔离执行（不同模型/会话）
- ✅ 纯粹的后台任务

**使用心跳当**:
- ✅ 多个检查可以批量执行
- ✅ 需要对话上下文
- ✅ 时序要求不严格

**避免**: 创建多个cron做相似的事情（合并到心跳）

---

## 代码模板

```bash
#!/bin/bash
# 描述：做什么
# 作者：贾维斯
# 日期：创建时间

LOG_FILE="/home/ubuntu/.openclaw/workspace/logs/xxx.log"
echo "===== 开始: $(date) =====" >> "$LOG_FILE"

# 1. 检查前置条件
if ! condition; then
    echo "错误: 原因" >> "$LOG_FILE"
    exit 1
fi

# 2. 执行任务
actual_command >> "$LOG_FILE" 2>&1

# 3. 清理
cleanup >> "$LOG_FILE" 2>&1

echo "===== 完成: $(date) =====" >> "$LOG_FILE"
```

---

## 关联

- [[123盘自动备份系统]] - 实践案例
- [[系统管理]] - 应用领域
- [[日志管理]] - 监控方法
