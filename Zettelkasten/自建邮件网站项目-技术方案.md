# è‡ªå»ºé‚®ä»¶ç½‘ç«™é¡¹ç›® - æŠ€æœ¯æ–¹æ¡ˆ

**åŸŸå**: mail.dhmip.cnï¼ˆå·²è§£æï¼‰
**æœåŠ¡å™¨**: 82.157.20.7
**æŠ€æœ¯æ ˆ**: Postfix + Dovecot + MySQL + PHP

---

## ğŸ“‹ å®‰è£…æ­¥éª¤

### 1. å®‰è£…Postfixï¼ˆSMTPæœåŠ¡å™¨ï¼‰
```bash
# å®‰è£…Postfix
yum install postfix -y

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
systemctl start postfix
systemctl enable postfix

# æ£€æŸ¥çŠ¶æ€
systemctl status postfix
```

### 2. å®‰è£…Dovecotï¼ˆIMAP/POP3æœåŠ¡å™¨ï¼‰
```bash
# å®‰è£…Dovecot
yum install dovecot dovecot-mysql -y

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
systemctl start dovecot
systemctl enable dovecot

# æ£€æŸ¥çŠ¶æ€
systemctl status dovecot
```

### 3. é…ç½®Postfix
**ä¸»é…ç½®æ–‡ä»¶**: `/etc/postfix/main.cf`

**å…³é”®é…ç½®**:
```conf
# ä¸»æœºå
myhostname = mail.dhmip.cn
mydomain = dhmip.cn

# é‚®ç®±æ ¼å¼
mail_spool_directory = /var/mail
home_mailbox = Maildir/

# SMTPè®¤è¯
smtpd_sasl_auth_enable = yes
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth

# ç½‘ç»œè®¾ç½®
inet_interfaces = all
inet_protocols = ipv4
mynetworks = 127.0.0.0/8

# é‚®ç®±å¤§å°é™åˆ¶ï¼ˆ10MBï¼‰
message_size_limit = 10240000
mailbox_size_limit = 102400000
```

### 4. é…ç½®Dovecot
**ä¸»é…ç½®æ–‡ä»¶**: `/etc/dovecot/dovecot.conf`

**å…³é”®é…ç½®**:
```
protocols = imap pop3
listen = *

base_dir = /var/run/dovecot/
instance_name = dovecot

# Mailboxæ ¼å¼
mail_location = maildir:~/Maildir

# è®¤è¯
auth_mechanisms = plain login
!include auth-system.conf.ext
```

### 5. åˆ›å»ºæµ‹è¯•é‚®ç®±
```bash
# åˆ›å»ºç³»ç»Ÿç”¨æˆ·
useradd -m test1
passwd test1

# å‘é€æµ‹è¯•é‚®ä»¶
echo "æµ‹è¯•å†…å®¹" | mail -s "æµ‹è¯•ä¸»é¢˜" test1@dhmip.cn
```

### 6. æµ‹è¯•SMTP
```bash
telnet localhost 25

# SMTPå‘½ä»¤
ehlo mail.dhmip.cn
mail from: <test1@dhmip.cn>
rcpt to: <test1@dhmip.cn>
data
Subject: æµ‹è¯•é‚®ä»¶

è¿™æ˜¯ä¸€å°æµ‹è¯•é‚®ä»¶ã€‚
.
quit
```

### 7. æµ‹è¯•IMAP
```bash
telnet localhost 143

# IMAPå‘½ä»¤
a1 LOGIN test1 password
a2 LIST "" "*"
a3 SELECT INBOX
a4 LOGOUT
```

---

## ğŸŒ PHP Webç•Œé¢å¼€å‘

### åŠŸèƒ½éœ€æ±‚
1. ç”¨æˆ·æ³¨å†Œï¼ˆåˆ›å»ºé‚®ç®±ï¼‰
2. ç”¨æˆ·ç™»å½•
3. æ”¶å‘é‚®ä»¶
4. ç®¡ç†é‚®ç®±

### æŠ€æœ¯æ ˆ
- **åç«¯**: PHP 8.3
- **å‰ç«¯**: HTML + CSS + JavaScript
- **æ•°æ®åº“**: MySQL/MariaDB
- **WebæœåŠ¡å™¨**: Nginx

### ç›®å½•ç»“æ„
```
/www/wwwroot/mail.dhmip.cn/
â”œâ”€â”€ index.php          # ç™»å½•é¡µ
â”œâ”€â”€ register.php       # æ³¨å†Œé¡µ
â”œâ”€â”€ inbox.php          # æ”¶ä»¶ç®±
â”œâ”€â”€ compose.php        # å†™é‚®ä»¶
â”œâ”€â”€ config.php         # é…ç½®æ–‡ä»¶
â”œâ”€â”€ functions.php      # å·¥å…·å‡½æ•°
â””â”€â”€ assets/
    â”œâ”€â”€ css/
    â”œâ”€â”€ js/
    â””â”€â”€ images/
```

---

## ğŸ” SSL/TLSé…ç½®

### ç”Ÿæˆè¯ä¹¦
```bash
# ä½¿ç”¨Let's Encrypt
yum install certbot -y
certbot certonly --standalone -d mail.dhmip.cn
```

### é…ç½®Nginx
```nginx
server {
    listen 443 ssl;
    server_name mail.dhmip.cn;

    ssl_certificate /etc/letsencrypt/live/mail.dhmip.cn/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/mail.dhmip.cn/privkey.pem;

    root /www/wwwroot/mail.dhmip.cn;
    index index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/tmp/php-cgi.sock;
        fastcgi_index index.php;
        include fastcgi.conf;
    }
}
```

---

## ğŸ“ æµ‹è¯•è®¡åˆ’

1. **æœ¬åœ°æµ‹è¯•**
   - [ ] Postfixå‘é€é‚®ä»¶
   - [ ] Dovecotæ¥æ”¶é‚®ä»¶
   - [ ] SMTPè®¤è¯
   - [ ] IMAPè®¿é—®

2. **Webç•Œé¢æµ‹è¯•**
   - [ ] ç”¨æˆ·æ³¨å†Œ
   - [ ] ç”¨æˆ·ç™»å½•
   - [ ] å‘é€é‚®ä»¶
   - [ ] æ¥æ”¶é‚®ä»¶
   - [ ] é™„ä»¶åŠŸèƒ½

3. **SSLæµ‹è¯•**
   - [ ] HTTPSè®¿é—®
   - [ ] è¯ä¹¦æœ‰æ•ˆæ€§
   - [ ] åŠ å¯†ä¼ è¾“

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. æ£€æŸ¥å½“å‰ç³»ç»ŸçŠ¶æ€
2. å®‰è£…Postfix
3. å®‰è£…Dovecot
4. é…ç½®åŸºç¡€æœåŠ¡
5. åˆ›å»ºæµ‹è¯•é‚®ç®±
6. æµ‹è¯•é‚®ä»¶æ”¶å‘
7. å¼€å‘PHP Webç•Œé¢
8. é…ç½®SSLè¯ä¹¦
9. å®Œæ•´æµ‹è¯•

---

**å‡†å¤‡æ—¶é—´**: 2026-02-06 10:13
**å¼€å§‹æ—¶é—´**: å³å°†å¼€å§‹
**é¢„è®¡å®Œæˆ**: å‡Œæ™¨è‡ªä¸»å­¦ä¹ æ—¶æ®µ
